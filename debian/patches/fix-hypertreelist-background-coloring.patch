Description: Fix full-row background coloring in HyperTreeList
 This patch applies fixes from wxPython PR #2088 to correct background
 coloring issues in wx.lib.agw.hypertreelist when using TR_FULL_ROW_HIGHLIGHT
 and TR_FILL_WHOLE_COLUMN_BACKGROUND flags.
 .
 Without this patch, only text backgrounds are colored instead of full rows,
 and right-aligned columns (like date fields) have gaps in the background.
 .
 The fix was merged upstream and included in wxPython 4.2.4 (released
 October 28, 2025). This patch is required for Debian versions shipping
 wxPython < 4.2.4 (Bookworm has 4.2.0, Trixie/Sid have 4.2.3).
Author: cbeytas <cbeytas@users.noreply.github.com>
Origin: upstream, https://github.com/wxWidgets/Phoenix/pull/2088
Bug: https://github.com/wxWidgets/Phoenix/issues/2081
Bug: https://github.com/wxWidgets/Phoenix/issues/1898
Forwarded: not-needed
Applied-Upstream: 4.2.4
Last-Update: 2025-12-14
---
This patch modifies wx/lib/agw/hypertreelist.py to fix two issues:

1. Issue #2081 (TR_FULL_ROW_HIGHLIGHT): The drawItemBackground branch
   contained only 'pass', so backgrounds were never drawn for full-row
   highlight mode. Fix: Draw the full-row rectangle before the column loop.

2. Issue #1898 (TR_FILL_WHOLE_COLUMN_BACKGROUND): For right-aligned text,
   using text_x-2 as the rectangle x-position left gaps on the left side
   of columns. Fix: Use x_colstart (column start position) instead.

--- a/wx/lib/agw/hypertreelist.py
+++ b/wx/lib/agw/hypertreelist.py
@@ -3024,9 +3024,12 @@ class TreeListMainWindow(wx.ScrolledWindow):
             # On GTK+ 2, drawing a 'normal' background is wrong for themes that
             # don't allow backgrounds to be customized. Not drawing the background,
             # except for custom item backgrounds, works for both kinds of theme.
             elif drawItemBackground:
-                pass
-                # We have to colour the item background for each column separately
-                # So it is better to move this functionality in the subsequent for loop.
+                # Fix from Issue #2081 (Roland171281) - Draw full row background
+                itemrect = wx.Rect(0, item.GetY() + off_h, total_w-1, total_h - off_h)
+                dc.SetBrush(wx.Brush(colBg, wx.SOLID))
+                dc.DrawRectangle(itemrect)
+                dc.SetTextForeground(colText)
+
             else:
                 dc.SetTextForeground(colText)

@@ -3034,6 +3037,14 @@ class TreeListMainWindow(wx.ScrolledWindow):
+        elif drawItemBackground and self.HasAGWFlag(TR_FILL_WHOLE_COLUMN_BACKGROUND):
+            # Draw full row background BEFORE column loop to avoid clipping issues
+            # Fix from Issue #1898 - use full row rect instead of per-column
+            itemrect = wx.Rect(0, item.GetY() + off_h, total_w-1, total_h - off_h)
+            dc.SetBrush(wx.Brush(colBg, wx.SOLID))
+            dc.SetPen(wx.TRANSPARENT_PEN)
+            dc.DrawRectangle(itemrect)
+            dc.SetTextForeground(colText)
         else:
             dc.SetTextForeground(colText)

@@ -3119,8 +3130,11 @@ class TreeListMainWindow(wx.ScrolledWindow):
                     # except for custom item backgrounds, works for both kinds of theme.
                     elif drawItemBackground:

-                        if self.HasAGWFlag(TR_FILL_WHOLE_COLUMN_BACKGROUND):
-                            itemrect = wx.Rect(text_x-2, item.GetY() + off_h, col_w-2*_MARGIN, total_h - off_h)
+                        if not self.HasAGWFlag(TR_FILL_WHOLE_COLUMN_BACKGROUND):
+                            # Only draw per-column background if not filling whole columns
+                            # (full row background was already drawn before column loop)
+                            itemrect = wx.Rect(text_x-2, item.GetY() + off_h, text_w+2*_MARGIN, total_h - off_h)
+                            dc.SetBrush(wx.Brush(colBg))
                             dc.DrawRectangle(itemrect)

                         dc.SetTextForeground(colText)
@@ -3132,9 +3146,11 @@ class TreeListMainWindow(wx.ScrolledWindow):

                 else:

-                    if self.HasAGWFlag(TR_FILL_WHOLE_COLUMN_BACKGROUND):
-                        itemrect = wx.Rect(text_x-2, item.GetY() + off_h, col_w-2*_MARGIN, total_h - off_h)
-                        colBgX = item.GetBackgroundColour(i)
+                    if not self.HasAGWFlag(TR_FILL_WHOLE_COLUMN_BACKGROUND):
+                        # Only draw per-column background if not filling whole columns
+                        # (full row background was already drawn before column loop)
+                        itemrect = wx.Rect(text_x-2, item.GetY() + off_h, text_w+2*_MARGIN, total_h - off_h)
+                        colBgX = item.GetBackgroundColour(i)
                         if colBgX.IsOk():
                             dc.SetBrush(wx.Brush(colBgX, wx.SOLID))
                             dc.DrawRectangle(itemrect)
@@ -3148,9 +3164,11 @@ class TreeListMainWindow(wx.ScrolledWindow):

                 if not item.IsSelected():

-                    if self.HasAGWFlag(TR_FILL_WHOLE_COLUMN_BACKGROUND):
-                        itemrect = wx.Rect(text_x-2, item.GetY() + off_h, col_w-2*_MARGIN, total_h - off_h)
-                        colBgX = item.GetBackgroundColour(i)
+                    if not self.HasAGWFlag(TR_FILL_WHOLE_COLUMN_BACKGROUND):
+                        # Only draw per-column background if not filling whole columns
+                        # (full row background was already drawn before column loop)
+                        itemrect = wx.Rect(text_x-2, item.GetY() + off_h, text_w+2*_MARGIN, total_h - off_h)
+                        colBgX = item.GetBackgroundColour(i)
                         if colBgX.IsOk():
                             dc.SetBrush(wx.Brush(colBgX, wx.SOLID))
                             dc.DrawRectangle(itemrect)
